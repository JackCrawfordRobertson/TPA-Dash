<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#28313E">
    <title>Global Payment Reach & Growth</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        :root {
            --bg-primary: #28313E;
            --bg-secondary: #323D4D;
            --accent-primary: #01D6B0;
            --accent-secondary: #00B399;
            --text-primary: #FFFFFF;
            --text-secondary: #E0E0E0;
            --text-tertiary: #9CA3AF;
            --border-color: #4A5668;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -webkit-text-size-adjust: 100%;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, #3A4655 100%);
            padding: max(0.75rem, env(safe-area-inset-top)) 1rem 0.75rem;
            border-bottom: 2px solid var(--accent-primary);
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.1rem;
            letter-spacing: -0.3px;
        }

        .header-subtitle {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
            text-align: center;
        }

        .header-desc {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            line-height: 1.3;
            text-align: center;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Main Content */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            gap: 0;
        }

        /* Map Container */
        .map-container {
            flex: 0 1 45vh;
            position: relative;
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            overflow: hidden;
            min-height: 250px;
        }

        #map {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Top Markets Section */
        .top-markets {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .markets-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            flex-shrink: 0;
        }

        .markets-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        /* Metric Card for Mobile */
        .metric-card-mobile {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
            active-color: transparent;
        }

        .metric-card-mobile:active {
            transform: scale(0.98);
            border-color: var(--accent-primary);
        }

        .metric-rank {
            font-size: 0.65rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.3px;
            margin-bottom: 0.3rem;
        }

        .metric-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.3rem;
        }

        .metric-value {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.2rem;
        }

        .metric-label {
            font-size: 0.65rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* Footer */
        .footer {
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 0.75rem 1rem max(0.75rem, env(safe-area-inset-bottom));
            font-size: 0.7rem;
            color: var(--text-tertiary);
            text-align: center;
            flex-shrink: 0;
            line-height: 1.4;
        }

        .footer a {
            color: var(--accent-primary);
            text-decoration: none;
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(40, 49, 62, 0.95);
            color: #fff;
            padding: 12px;
            border-radius: 6px;
            font-size: 11px;
            pointer-events: none;
            z-index: 100;
            border: 1px solid var(--accent-primary);
            backdrop-filter: blur(10px);
            max-width: 280px;
            display: none;
            box-shadow: 0 4px 12px rgba(1, 214, 176, 0.2);
        }

        .tooltip-title {
            font-weight: 700;
            font-size: 12px;
            margin-bottom: 8px;
            color: var(--accent-primary);
            border-bottom: 2px solid var(--accent-primary);
            padding-bottom: 6px;
        }

        .tooltip-row {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            padding: 4px 0;
            color: var(--text-secondary);
        }

        .tooltip-year {
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .tooltip-value {
            font-weight: 600;
            color: var(--accent-primary);
            text-align: right;
        }

        /* Hide scrollbar styling for mobile */
        .content::-webkit-scrollbar,
        .top-markets::-webkit-scrollbar {
            display: none;
        }

        /* Scrollbar for desktop fallback */
        @supports (scrollbar-width: thin) {
            .content,
            .top-markets {
                scrollbar-width: thin;
                scrollbar-color: var(--accent-primary) transparent;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Global Payment Reach</h1>
            <p class="header-subtitle">2025 Transaction Values</p>
            <p class="header-desc">Explore worldwide payment markets with real-time 3D globe visualization</p>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- Map Container -->
            <div class="map-container">
                <div id="map"></div>
                <div class="tooltip" id="tooltip">
                    <div class="tooltip-title" id="tooltip-country"></div>
                    <div id="tooltip-data"></div>
                </div>
            </div>

            <!-- Top Markets -->
            <div class="top-markets">
                <div class="markets-title">Top 5 Markets</div>
                <div class="markets-container">
                    <div class="metric-card-mobile">
                        <div class="metric-rank">1st</div>
                        <div class="metric-name">United States</div>
                        <div class="metric-value">$2.65T</div>
                        <div class="metric-label">2025</div>
                    </div>

                    <div class="metric-card-mobile">
                        <div class="metric-rank">2nd</div>
                        <div class="metric-name">China</div>
                        <div class="metric-value">$780B</div>
                        <div class="metric-label">2025</div>
                    </div>

                    <div class="metric-card-mobile">
                        <div class="metric-rank">3rd</div>
                        <div class="metric-name">Japan</div>
                        <div class="metric-value">$445B</div>
                        <div class="metric-label">2025</div>
                    </div>

                    <div class="metric-card-mobile">
                        <div class="metric-rank">4th</div>
                        <div class="metric-name">UK</div>
                        <div class="metric-value">$235B</div>
                        <div class="metric-label">2025</div>
                    </div>

                    <div class="metric-card-mobile">
                        <div class="metric-rank">5th</div>
                        <div class="metric-name">Germany</div>
                        <div class="metric-value">$210B</div>
                        <div class="metric-label">2025</div>
                    </div>

                    <div class="metric-card-mobile" style="opacity: 0.6;">
                        <div class="metric-rank">+22</div>
                        <div class="metric-name">Other Markets</div>
                        <div class="metric-value">$2.5T</div>
                        <div class="metric-label">Combined</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Data: McKinsey Global Payments, The Payments Association, Research & Markets</p>
        </div>
    </div>

    <script>
        // Mapbox API key
        mapboxgl.accessToken = 'pk.eyJ1IjoidHBhLXZpeiIsImEiOiJjbWhtNXE0NmowandvMmlxazQ0NTNtaGRpIn0.aN_mnCiCV54rcFjRW7GNYw';

        // Detect mobile device
        const isMobile = () => window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // Payment data from CSV 2025 (in billions USD)
        const paymentData = {
            "Argentina": { "2021": 43.7, "2022": 60.44, "2023": 73.86, "2024": 86.52, "2025": 101.39 },
            "Armenia": { "2021": 1.1, "2022": 1.6, "2023": 2.06, "2024": 2.36, "2025": 2.72 },
            "Australia": { "2021": 76.34, "2022": 97.31, "2023": 110.76, "2024": 123.02, "2025": 138.98 },
            "Austria": { "2021": 15.65, "2022": 19.43, "2023": 24.7, "2024": 27.55, "2025": 31.62 },
            "Azerbaijan": { "2021": 3.2, "2022": 4.97, "2023": 5.63, "2024": 6.28, "2025": 7.27 },
            "Bahrain": { "2021": 2.41, "2022": 3.37, "2023": 4.06, "2024": 4.49, "2025": 5.03 },
            "Bangladesh": { "2021": 18.55, "2022": 25.62, "2023": 30.37, "2024": 34.15, "2025": 39.73 },
            "Belarus": { "2021": 3.42, "2022": 4.76, "2023": 5.65, "2024": 6.24, "2025": 7.01 },
            "Belgium": { "2021": 23.51, "2022": 32.42, "2023": 39.64, "2024": 46.62, "2025": 54.78 },
            "Belize": { "2021": 0.6, "2022": 0.9, "2023": 0.95, "2024": 1.34, "2025": 1.54 },
            "Benin": { "2021": 1.01, "2022": 1.34, "2023": 1.74, "2024": 2.09, "2025": 2.48 },
            "Bhutan": { "2021": 1.07, "2022": 1.47, "2023": 1.69, "2024": 2.03, "2025": 2.33 },
            "Bolivia": { "2021": 2.14, "2022": 2.92, "2023": 3.52, "2024": 4.21, "2025": 5.28 },
            "Bosnia and Herzegovina": { "2021": 1.68, "2022": 2.29, "2023": 2.96, "2024": 3.45, "2025": 4.05 },
            "Botswana": { "2021": 0.94, "2022": 1.31, "2023": 1.56, "2024": 1.84, "2025": 2.17 },
            "Brazil": { "2021": 152.93, "2022": 222.98, "2023": 285.1, "2024": 346.71, "2025": 415.98 },
            "Brunei Darussalam": { "2021": 1.57, "2022": 2.14, "2023": 2.43, "2024": 2.75, "2025": 3.04 },
            "Bulgaria": { "2021": 3.93, "2022": 5.37, "2023": 6.84, "2024": 8.08, "2025": 9.45 },
            "Burkina Faso": { "2021": 1.27, "2022": 1.7, "2023": 2.15, "2024": 2.6, "2025": 3.11 },
            "Burundi": { "2021": 0.51, "2022": 0.72, "2023": 0.9, "2024": 1.07, "2025": 1.36 },
            "Cambodia": { "2021": 2.16, "2022": 2.98, "2023": 3.73, "2024": 4.42, "2025": 5.23 },
            "Cameroon": { "2021": 2.25, "2022": 2.96, "2023": 3.78, "2024": 4.47, "2025": 5.3 },
            "Canada": { "2021": 113.4, "2022": 147.76, "2023": 171.97, "2024": 195.1, "2025": 224.52 },
            "Chad": { "2021": 1.02, "2022": 1.4, "2023": 1.75, "2024": 2.07, "2025": 2.41 },
            "Chile": { "2021": 17.53, "2022": 23.53, "2023": 28.22, "2024": 32.91, "2025": 38.9 },
            "China": { "2021": 3946.07, "2022": 5338.02, "2023": 6283.78, "2024": 7028.49, "2025": 7805.6 },
            "Costa Rica": { "2021": 2.91, "2022": 3.87, "2023": 5.33, "2024": 6.31, "2025": 7.51 },
            "Croatia": { "2021": 3.37, "2022": 4.74, "2023": 6.18, "2024": 7.16, "2025": 8.27 },
            "Cuba": { "2021": 1.9, "2022": 2.64, "2023": 3.19, "2024": 3.57, "2025": 4.07 },
            "Cyprus": { "2021": 2.82, "2022": 3.63, "2023": 4.46, "2024": 5.1, "2025": 5.92 },
            "Czechia": { "2021": 10.42, "2022": 13.69, "2023": 17.91, "2024": 19.8, "2025": 23.01 },
            "Denmark": { "2021": 23.06, "2022": 30.42, "2023": 35.71, "2024": 40.61, "2025": 46.44 },
            "Dominican Republic": { "2021": 3.93, "2022": 5.69, "2023": 7.04, "2024": 8.13, "2025": 9.35 },
            "Ecuador": { "2021": 4.13, "2022": 5.65, "2023": 6.96, "2024": 7.92, "2025": 9.24 },
            "Egypt": { "2021": 16.66, "2022": 23.29, "2023": 24.6, "2024": 27.24, "2025": 29.34 },
            "El Salvador": { "2021": 1.54, "2022": 2.14, "2023": 2.66, "2024": 3.13, "2025": 3.7 },
            "Equatorial Guinea": { "2021": 0.57, "2022": 0.69, "2023": 0.79, "2024": 0.97, "2025": 1.23 },
            "Estonia": { "2021": 3.07, "2022": 4.09, "2023": 4.97, "2024": 5.42, "2025": 6.03 },
            "Ethiopia": { "2021": 6.87, "2022": 9.95, "2023": 13.79, "2024": 15, "2025": 15.99 },
            "Fiji": { "2021": 1.26, "2022": 1.79, "2023": 2.14, "2024": 2.52, "2025": 2.92 },
            "Finland": { "2021": 17.64, "2022": 23.62, "2023": 28.24, "2024": 32.6, "2025": 38.24 },
            "France": { "2021": 167.03, "2022": 216.7, "2023": 250.51, "2024": 280.81, "2025": 317.09 },
            "Gabon": { "2021": 0.94, "2022": 1.28, "2023": 1.55, "2024": 1.83, "2025": 2.07 },
            "Gambia": { "2021": 0.29, "2022": 0.43, "2023": 0.56, "2024": 0.7, "2025": 0.85 },
            "Germany": { "2021": 131.72, "2022": 173.32, "2023": 204.24, "2024": 233.29, "2025": 271.97 },
            "Ghana": { "2021": 3.98, "2022": 5.06, "2023": 6.4, "2024": 7.73, "2025": 9.36 },
            "Greece": { "2021": 7.85, "2022": 10.22, "2023": 13.27, "2024": 15.25, "2025": 17.65 },
            "Guatemala": { "2021": 3.45, "2022": 4.79, "2023": 6.12, "2024": 7.25, "2025": 8.7 },
            "Guinea": { "2021": 0.97, "2022": 1.4, "2023": 1.83, "2024": 2.22, "2025": 2.76 },
            "Guyana": { "2021": 0.89, "2022": 1.52, "2023": 2, "2024": 2.83, "2025": 3.4 },
            "Haiti": { "2021": 1.41, "2022": 1.88, "2023": 2.31, "2024": 2.98, "2025": 3.84 },
            "Honduras": { "2021": 1.57, "2022": 2.2, "2023": 2.76, "2024": 3.34, "2025": 3.93 },
            "Hungary": { "2021": 7.31, "2022": 9.17, "2023": 12.35, "2024": 13.98, "2025": 16.36 },
            "Iceland": { "2021": 2.99, "2022": 3.96, "2023": 4.68, "2024": 5.13, "2025": 5.67 },
            "India": { "2021": 521.09, "2022": 751.66, "2023": 947.61, "2024": 1137.74, "2025": 1354.23 },
            "Indonesia": { "2021": 120.07, "2022": 165.2, "2023": 201.34, "2024": 236.46, "2025": 281.21 },
            "Iran": { "2021": 13.25, "2022": 20.25, "2023": 24.12, "2024": 28.3, "2025": 29.07 },
            "Iraq": { "2021": 7.98, "2022": 13.1, "2023": 14.83, "2024": 17.43, "2025": 18.65 },
            "Ireland": { "2021": 16.07, "2022": 22.28, "2023": 27.44, "2024": 32.43, "2025": 38.4 },
            "Israel": { "2021": 15.61, "2022": 20.87, "2023": 24.2, "2024": 27.91, "2025": 33.61 },
            "Italy": { "2021": 88.78, "2022": 124.24, "2023": 153.8, "2024": 182.42, "2025": 214.96 },
            "Ivory Coast": { "2021": 3.13, "2022": 4.03, "2023": 5.22, "2024": 6.21, "2025": 7.29 },
            "Jamaica": { "2021": 1.25, "2022": 1.8, "2023": 2.26, "2024": 2.82, "2025": 3.28 },
            "Japan": { "2021": 301.62, "2022": 390.73, "2023": 451.27, "2024": 507.58, "2025": 579.35 },
            "Jordan": { "2021": 2.49, "2022": 3.46, "2023": 4.25, "2024": 4.93, "2025": 5.73 },
            "Kazakhstan": { "2021": 7.57, "2022": 10.72, "2023": 14.23, "2024": 16.75, "2025": 19.68 },
            "Kenya": { "2021": 5.93, "2022": 7.96, "2023": 9.26, "2024": 10.99, "2025": 13.08 },
            "Kuwait": { "2021": 5.52, "2022": 8.3, "2023": 9.06, "2024": 9.81, "2025": 10.72 },
            "Kyrgyzstan": { "2021": 0.94, "2022": 1.5, "2023": 2.06, "2024": 2.62, "2025": 3.25 },
            "Laos": { "2021": 1.44, "2022": 1.78, "2023": 2.17, "2024": 2.63, "2025": 3.17 },
            "Latvia": { "2021": 3.08, "2022": 4.1, "2023": 5.05, "2024": 5.54, "2025": 6.21 },
            "Lebanon": { "2021": 1.53, "2022": 2.22, "2023": 2.55, "2024": 3.13, "2025": 3.52 },
            "Lesotho": { "2021": 0.34, "2022": 0.46, "2023": 0.56, "2024": 0.66, "2025": 0.77 },
            "Lithuania": { "2021": 3.92, "2022": 5.23, "2023": 6.5, "2024": 7.38, "2025": 8.46 },
            "Luxembourg": { "2021": 4.4, "2022": 5.42, "2023": 6.65, "2024": 7.57, "2025": 8.64 },
            "Madagascar": { "2021": 1.44, "2022": 2.03, "2023": 2.51, "2024": 2.98, "2025": 3.53 },
            "Malawi": { "2021": 1.03, "2022": 1.39, "2023": 1.74, "2024": 1.96, "2025": 2.4 },
            "Malaysia": { "2021": 34.31, "2022": 46.08, "2023": 54.65, "2024": 62.18, "2025": 71.53 },
            "Malta": { "2021": 2.3, "2022": 3.15, "2023": 3.87, "2024": 4.39, "2025": 5.01 },
            "Mauritius": { "2021": 0.68, "2022": 1.03, "2023": 1.32, "2024": 1.58, "2025": 1.87 },
            "Mexico": { "2021": 73.69, "2022": 92.92, "2023": 104.5, "2024": 112.16, "2025": 127.12 },
            "Moldova": { "2021": 1.51, "2022": 2.02, "2023": 2.53, "2024": 2.99, "2025": 3.67 },
            "Mongolia": { "2021": 1.68, "2022": 2.31, "2023": 2.86, "2024": 3.28, "2025": 4 },
            "Montenegro": { "2021": 1.37, "2022": 1.98, "2023": 2.41, "2024": 2.69, "2025": 3.06 },
            "Morocco": { "2021": 6.29, "2022": 7.81, "2023": 9.94, "2024": 11.65, "2025": 13.78 },
            "Mozambique": { "2021": 1.45, "2022": 2.08, "2023": 2.63, "2024": 3.09, "2025": 3.67 },
            "Myanmar": { "2021": 4.58, "2022": 6.27, "2023": 7.56, "2024": 8.51, "2025": 9.96 },
            "Namibia": { "2021": 0.74, "2022": 0.97, "2023": 1.19, "2024": 1.44, "2025": 1.72 },
            "Nepal": { "2021": 2.59, "2022": 3.7, "2023": 4.38, "2024": 5.22, "2025": 6.2 },
            "Netherlands": { "2021": 47.06, "2022": 63.61, "2023": 75.9, "2024": 86.36, "2025": 98.13 },
            "New Zealand": { "2021": 11.26, "2022": 13.95, "2023": 15.45, "2024": 16.69, "2025": 18.48 },
            "Nicaragua": { "2021": 1.03, "2022": 1.4, "2023": 1.88, "2024": 2.31, "2025": 2.78 },
            "Niger": { "2021": 1.16, "2022": 1.61, "2023": 2.03, "2024": 2.5, "2025": 2.98 },
            "Nigeria": { "2021": 31.27, "2022": 47.25, "2023": 60.94, "2024": 72.9, "2025": 84.57 },
            "North Macedonia": { "2021": 1.88, "2022": 2.57, "2023": 3.13, "2024": 3.49, "2025": 3.96 },
            "Norway": { "2021": 23.33, "2022": 31.31, "2023": 37.33, "2024": 42.88, "2025": 49.19 },
            "Oman": { "2021": 3.77, "2022": 5.61, "2023": 6.49, "2024": 7.33, "2025": 8.06 },
            "Pakistan": { "2021": 18.18, "2022": 24.92, "2023": 28.5, "2024": 33.88, "2025": 39.74 },
            "Panama": { "2021": 2.73, "2022": 3.79, "2023": 4.77, "2024": 5.53, "2025": 6.49 },
            "Papua New Guinea": { "2021": 1.35, "2022": 2, "2023": 2.33, "2024": 2.71, "2025": 3.17 },
            "Paraguay": { "2021": 2.22, "2022": 2.88, "2023": 3.46, "2024": 3.73, "2025": 4.32 },
            "Philippines": { "2021": 44.04, "2022": 60.43, "2023": 73.59, "2024": 86.69, "2025": 103.36 },
            "Poland": { "2021": 50.52, "2022": 72.39, "2023": 91.58, "2024": 109.93, "2025": 131.16 },
            "Portugal": { "2021": 9.11, "2022": 11.76, "2023": 15.33, "2024": 17.77, "2025": 20.65 },
            "Puerto Rico": { "2021": 4.03, "2022": 5.39, "2023": 6.63, "2024": 7.48, "2025": 8.48 },
            "Republic of the Congo": { "2021": 0.65, "2022": 0.89, "2023": 1.05, "2024": 1.29, "2025": 1.53 },
            "Romania": { "2021": 10.13, "2022": 13.23, "2023": 17.94, "2024": 21.35, "2025": 25.12 },
            "Russia": { "2021": 58.69, "2022": 90.15, "2023": 97.5, "2024": 112.26, "2025": 122.26 },
            "Rwanda": { "2021": 0.83, "2022": 1.19, "2023": 1.53, "2024": 1.75, "2025": 2.06 },
            "Saudi Arabia": { "2021": 30.08, "2022": 44.71, "2023": 58.19, "2024": 71.41, "2025": 86.37 },
            "Senegal": { "2021": 1.66, "2022": 2.22, "2023": 2.81, "2024": 3.35, "2025": 4.01 },
            "Serbia": { "2021": 3.35, "2022": 4.56, "2023": 6.15, "2024": 7.16, "2025": 8.23 },
            "Seychelles": { "2021": 0.44, "2022": 0.54, "2023": 0.76, "2024": 0.78, "2025": 0.94 },
            "Sierra Leone": { "2021": 0.52, "2022": 0.7, "2023": 0.83, "2024": 1.02, "2025": 1.22 },
            "Singapore": { "2021": 26.07, "2022": 33.75, "2023": 38.82, "2024": 43.04, "2025": 48.84 },
            "Slovakia": { "2021": 5.27, "2022": 6.48, "2023": 8.58, "2024": 9.76, "2025": 11.21 },
            "Slovenia": { "2021": 3.6, "2022": 4.56, "2023": 5.78, "2024": 6.5, "2025": 7.4 },
            "South Africa": { "2021": 10.37, "2022": 14.91, "2023": 18.9, "2024": 22.84, "2025": 27.64 },
            "South Korea": { "2021": 137.37, "2022": 171.35, "2023": 190.92, "2024": 206.86, "2025": 230 },
            "Spain": { "2021": 92.86, "2022": 118.54, "2023": 135.4, "2024": 150.96, "2025": 170.87 },
            "Sri Lanka": { "2021": 3.76, "2022": 4.39, "2023": 5.61, "2024": 6.92, "2025": 8.26 },
            "Sudan": { "2021": 2.8, "2022": 3.75, "2023": 4.73, "2024": 5.03, "2025": 6.03 },
            "Suriname": { "2021": 0.95, "2022": 1.28, "2023": 1.54, "2024": 1.91, "2025": 2.26 },
            "Sweden": { "2021": 37.29, "2022": 50.37, "2023": 60.73, "2024": 70.68, "2025": 82.14 },
            "Switzerland": { "2021": 24.97, "2022": 31.82, "2023": 40.46, "2024": 46.43, "2025": 52.81 },
            "Taiwan": { "2021": 47.08, "2022": 60.13, "2023": 68.24, "2024": 75.13, "2025": 83.59 },
            "Tajikistan": { "2021": 0.97, "2022": 1.43, "2023": 1.83, "2024": 2.29, "2025": 2.98 },
            "Tanzania": { "2021": 3.9, "2022": 5.42, "2023": 6.81, "2024": 7.82, "2025": 9.32 },
            "Thailand": { "2021": 62.1, "2022": 86.59, "2023": 106.35, "2024": 125.31, "2025": 147.29 },
            "Timor-Leste": { "2021": 0.57, "2022": 0.64, "2023": 0.72, "2024": 0.85, "2025": 0.95 },
            "Togo": { "2021": 0.6, "2022": 0.82, "2023": 1.04, "2024": 1.26, "2025": 1.51 },
            "Tunisia": { "2021": 2.09, "2022": 2.6, "2023": 3.31, "2024": 3.91, "2025": 4.61 },
            "Turkey": { "2021": 47.43, "2022": 63.6, "2023": 76.37, "2024": 88.74, "2025": 105.28 },
            "Turkmenistan": { "2021": 2.37, "2022": 3.5, "2023": 4.45, "2024": 5.35, "2025": 6.61 },
            "Uganda": { "2021": 2.86, "2022": 4.06, "2023": 5.34, "2024": 6.49, "2025": 8.11 },
            "Ukraine": { "2021": 9.01, "2022": 10.09, "2023": 12.4, "2024": 14.31, "2025": 17.01 },
            "United Arab Emirates": { "2021": 27.02, "2022": 37.8, "2023": 46.89, "2024": 55.9, "2025": 66.37 },
            "United Kingdom": { "2021": 292.13, "2022": 379.53, "2023": 439.96, "2024": 495.15, "2025": 561.85 },
            "United States": { "2021": 1965.96, "2022": 2487.69, "2023": 2814.01, "2024": 3095.45, "2025": 3469.68 },
            "Uruguay": { "2021": 2.63, "2022": 3.77, "2023": 4.79, "2024": 5.44, "2025": 6.1 },
            "Uzbekistan": { "2021": 4.25, "2022": 6.14, "2023": 7.98, "2024": 9.68, "2025": 11.87 },
            "Vietnam": { "2021": 40.98, "2022": 56.22, "2023": 68.24, "2024": 79.79, "2025": 93.89 },
            "Zambia": { "2021": 1.36, "2022": 2.06, "2023": 2.45, "2024": 2.75, "2025": 3.34 },
            "Zimbabwe": { "2021": 1.78, "2022": 2.23, "2023": 2.8, "2024": 3.19, "2025": 3.82 }
        };

        // Mobile-optimized map initialization
        const mapOptions = {
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: [0, 20],
            zoom: 1.2,
            pitch: 30,
            bearing: 0,
            projection: 'globe',
            minZoom: 0.5,
            maxZoom: 4,
            attributionControl: false,
            touchZoomRotate: !isMobile(),
            touchPitch: !isMobile(),
            dragRotate: !isMobile()
        };

        const map = new mapboxgl.Map(mapOptions);

        // Keep globe centered when zooming
        map.on('zoom', function() {
            if (Math.abs(map.getCenter().lng) > 10 || Math.abs(map.getCenter().lat) > 30) {
                map.setCenter([0, 20]);
            }
        });

        let geoJsonData = null;
        const countryDataMap = new Map();

        // Country name mapping
        const countryNameMap = {
            "United States of America": "United States",
            "Russia": "Russia",
            "China": "China",
            "Canada": "Canada",
            "Brazil": "Brazil",
            "Australia": "Australia",
            "India": "India",
            "United Kingdom": "United Kingdom",
            "Germany": "Germany",
            "France": "France",
            "Japan": "Japan",
            "Mexico": "Mexico",
            "South Korea": "South Korea",
            "Republic of Korea": "South Korea",
            "Spain": "Spain",
            "Italy": "Italy",
            "Netherlands": "Netherlands",
            "Switzerland": "Switzerland",
            "Sweden": "Sweden",
            "Norway": "Norway",
            "Turkey": "Turkey",
            "United Arab Emirates": "UAE",
            "Indonesia": "Indonesia",
            "Thailand": "Thailand",
            "Philippines": "Philippines",
            "South Africa": "South Africa",
            "Nigeria": "Nigeria",
            "Hong Kong": "Hong Kong",
            "Singapore": "Singapore"
        };

        // Color interpolation
        function interpolateColor(color1, color2, factor) {
            const c1 = parseInt(color1.slice(1), 16);
            const c2 = parseInt(color2.slice(1), 16);
            const r = Math.round(((c1 >> 16) & 255) * (1 - factor) + ((c2 >> 16) & 255) * factor);
            const g = Math.round(((c1 >> 8) & 255) * (1 - factor) + ((c2 >> 8) & 255) * factor);
            const b = Math.round((c1 & 255) * (1 - factor) + (c2 & 255) * factor);
            return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase();
        }

        function getColorForValue(value, min, max) {
            const darkTeal = '#006B5F';
            const brightTeal = '#01D6B0';
            if (max === min) return brightTeal;
            const normalized = (value - min) / (max - min);
            return interpolateColor(darkTeal, brightTeal, normalized);
        }

        // Load GeoJSON
        async function loadGeoJson() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson');
                if (!response.ok) throw new Error('Failed to fetch GeoJSON');

                geoJsonData = await response.json();

                let minValue = Infinity, maxValue = 0;
                Object.values(paymentData).forEach(data => {
                    const val = data['2025'];
                    minValue = Math.min(minValue, val);
                    maxValue = Math.max(maxValue, val);
                });

                geoJsonData.features.forEach((feature, index) => {
                    let countryName = feature.properties.ADMIN || feature.properties.NAME || '';
                    if (countryNameMap[countryName]) countryName = countryNameMap[countryName];

                    if (paymentData[countryName]) {
                        const value = paymentData[countryName]['2025'];
                        const color = getColorForValue(value, minValue, maxValue);
                        feature.properties.value = value;
                        feature.properties.color = color;
                        feature.properties.COUNTRY_NAME = countryName;
                        countryDataMap.set(index, {
                            name: countryName,
                            value: value,
                            color: color,
                            data: paymentData[countryName]
                        });
                    } else {
                        feature.properties.value = 0;
                        feature.properties.color = '#4A5668';
                    }
                    if (feature.id === undefined) feature.id = index;
                });

                return true;
            } catch (error) {
                console.error('Error loading GeoJSON:', error);
                return false;
            }
        }

        // Format currency
        function formatCurrency(value) {
            if (value >= 1000) return (value / 1000).toFixed(2) + 'T';
            if (value >= 1) return value.toFixed(0) + 'B';
            return value.toFixed(0) + 'M';
        }

        // Initialize map and load data
        map.on('load', async function() {
            const success = await loadGeoJson();
            if (!success) return;

            map.addSource('countries', {
                type: 'geojson',
                data: geoJsonData
            });

            map.addLayer({
                id: 'countries-fill',
                type: 'fill',
                source: 'countries',
                paint: {
                    'fill-color': ['coalesce', ['feature-state', 'color'], ['get', 'color']],
                    'fill-opacity': ['case', ['boolean', ['feature-state', 'hover'], false], 0.9, 0.7]
                }
            });

            map.addLayer({
                id: 'countries-outline',
                type: 'line',
                source: 'countries',
                paint: {
                    'line-color': '#FFFFFF',
                    'line-width': ['case', ['boolean', ['feature-state', 'hover'], false], 2, 0.5],
                    'line-opacity': ['case', ['boolean', ['feature-state', 'hover'], false], 1, 0.15]
                }
            });

            // Hover interactions (touch-friendly)
            const tooltip = document.getElementById('tooltip');
            let hoveredFeatureId = null;

            map.on('mousemove', 'countries-fill', function(e) {
                if (e.features.length > 0) {
                    const featureId = e.features[0].id;
                    if (hoveredFeatureId !== null && hoveredFeatureId !== featureId) {
                        map.setFeatureState({ source: 'countries', id: hoveredFeatureId }, { hover: false });
                    }
                    hoveredFeatureId = featureId;
                    map.setFeatureState({ source: 'countries', id: hoveredFeatureId }, { hover: true });

                    const countryData = countryDataMap.get(hoveredFeatureId);
                    if (countryData) {
                        document.getElementById('tooltip-country').textContent = countryData.name;
                        const years = ['2021', '2022', '2023', '2024', '2025'];
                        let html = '';
                        years.forEach(year => {
                            const value = countryData.data[year];
                            if (value !== undefined) {
                                html += `
                                    <div class="tooltip-row">
                                        <span class="tooltip-year">${year}</span>
                                        <span class="tooltip-value">$${formatCurrency(value)}</span>
                                    </div>
                                `;
                            }
                        });
                        document.getElementById('tooltip-data').innerHTML = html;
                        tooltip.style.display = 'block';
                    }

                    tooltip.style.left = (e.originalEvent.pageX + 12) + 'px';
                    tooltip.style.top = (e.originalEvent.pageY + 12) + 'px';
                }
            });

            map.on('mouseleave', 'countries-fill', function() {
                if (hoveredFeatureId !== null) {
                    map.setFeatureState({ source: 'countries', id: hoveredFeatureId }, { hover: false });
                }
                hoveredFeatureId = null;
                tooltip.style.display = 'none';
            });

            document.addEventListener('mousemove', function(e) {
                if (tooltip.style.display === 'block') {
                    tooltip.style.left = (e.pageX + 12) + 'px';
                    tooltip.style.top = (e.pageY + 12) + 'px';
                }
            });
        });

        // Prevent default scroll behavior for better mobile experience
        document.addEventListener('touchmove', function(e) {
            if (e.target.closest('#map')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>

</body>
</html>
