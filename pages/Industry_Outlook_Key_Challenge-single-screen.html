<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Payments Association - Industry Overview</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Helvetica:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-primary: #323d4d;
        --bg-secondary: #323d4d;
        --bg-tertiary: #3a4655;
        --accent-primary: #01d6b0;
        --accent-secondary: #00b399;
        --text-primary: #ffffff;
        --text-secondary: #e0e0e0;
        --text-tertiary: #9ca3af;
        --border-color: #4a5668;
      }

      html,
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
          Helvetica, Arial, sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.5;
        height: 100%;
        overflow-x: hidden;
      }

      .container {
        display: flex;
        flex-direction: column;
        height: auto;
        min-height: 100vh;
        max-width: 100%;
        width: 100%;
        background-color: #323d4d;
        box-sizing: border-box;
      }

      /* Header */
      .header {
        background-color: #323d4d;
        padding: 1.5rem 2rem;
        border-bottom: 2px solid var(--accent-primary);
      }

      .header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
        letter-spacing: -0.5px;
      }

      .header-subtitle {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
        text-align: center;
      }

      .header-desc {
        font-size: 0.85rem;
        color: var(--text-tertiary);
        line-height: 1.4;
        text-align: center;
      }

      /* Main Content */
      .content {
        flex: 1;
        overflow-y: visible;
        overflow-x: hidden;
        padding: 1.5rem 2rem;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        grid-template-rows: auto auto;
        gap: 1.5rem;
        width: 100%;
        box-sizing: border-box;
      }

      /* Metrics Row */
      .metrics-row {
        grid-column: 1 / -1;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 0.5rem;
      }

      .metric-card {
        background-color: #323d4d;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1.25rem;
        text-align: center;
        transition: all 0.3s ease;
        min-width: 0;
        box-sizing: border-box;
      }

      .metric-card:hover {
        border-color: var(--accent-primary);
        box-shadow: 0 4px 12px rgba(1, 214, 176, 0.15);
        transform: translateY(-2px);
      }

      .metric-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--accent-primary);
        margin-bottom: 0.25rem;
      }

      .metric-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Chart Cards */
      .chart-card {
        background-color: #323d4d;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1.25rem;
        display: flex;
        flex-direction: column;
        min-width: 0;
        box-sizing: border-box;
      }

      .chart-card:hover {
        border-color: var(--accent-primary);
        box-shadow: 0 4px 12px rgba(1, 214, 176, 0.15);
      }

      .chart-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-primary);
        border-bottom: 2px solid var(--accent-primary);
        padding-bottom: 0.75rem;
      }

      .chart-container {
        position: relative;
        flex: 1;
        min-height: 220px;
      }

      /* Footer */
      .footer {
        background-color: #323d4d;
        border-top: 1px solid var(--border-color);
        padding: 1rem 2rem;
        font-size: 0.75rem;
        color: var(--text-tertiary);
        text-align: center;
      }

      /* Scrollbar Styling */
      .content::-webkit-scrollbar {
        width: 8px;
      }

      .content::-webkit-scrollbar-track {
        background: var(--bg-primary);
      }

      .content::-webkit-scrollbar-thumb {
        background: var(--accent-primary);
        border-radius: 4px;
      }

      .content::-webkit-scrollbar-thumb:hover {
        background: var(--accent-secondary);
      }

      /* Ultrawide Monitor Constraints */
      /* Responsive Design - Optimized Breakpoints */

      /* Ultra-wide Desktop: 1920px+ */
      @media (min-width: 1920px) {
        .container {
          max-width: 2400px;
          margin: 0 auto;
        }

        .content {
          grid-template-columns: repeat(5, 1fr);
          gap: 2rem;
          padding: 2rem 3rem;
        }

        .metrics-row {
          grid-template-columns: repeat(7, 1fr);
          gap: 1.5rem;
        }

        .header {
          padding: 1.5rem 3rem;
        }
      }

      /* Large Desktop: 1600px - 1919px */
      @media (min-width: 1600px) and (max-width: 1919px) {
        .content {
          grid-template-columns: repeat(4, 1fr);
          gap: 1.75rem;
          padding: 1.75rem 2.5rem;
        }

        .metrics-row {
          grid-template-columns: repeat(7, 1fr);
          gap: 1.25rem;
        }

        .header {
          padding: 1.5rem 2.5rem;
        }
      }

      /* Medium Desktop: 1400px - 1599px */
      @media (min-width: 1400px) and (max-width: 1599px) {
        .content {
          grid-template-columns: repeat(3, 1fr);
          gap: 1.5rem;
          padding: 1.5rem 2rem;
        }

        .metrics-row {
          grid-template-columns: repeat(4, 1fr);
          gap: 1rem;
        }
      }

      /* Small Desktop: 1200px - 1399px */
      @media (min-width: 1200px) and (max-width: 1399px) {
        .content {
          grid-template-columns: repeat(3, 1fr);
          gap: 1.25rem;
          padding: 1.5rem 1.75rem;
        }

        .metrics-row {
          grid-template-columns: repeat(3, 1fr);
          gap: 1rem;
        }

        /* Center the orphaned 7th metric card */
        .metrics-row .metric-card:nth-child(7) {
          grid-column: 2 / 3;
        }

        .header {
          padding: 1.25rem 1.75rem;
        }

        .header h1 {
          font-size: 1.6rem;
        }
      }

      /* Large Tablet: 1024px - 1199px */
      @media (min-width: 1024px) and (max-width: 1199px) {
        .content {
          grid-template-columns: repeat(2, 1fr);
          gap: 1.25rem;
          padding: 1.25rem 1.5rem;
        }

        .metrics-row {
          grid-template-columns: repeat(2, 1fr);
          gap: 0.875rem;
        }

        /* Center and constrain the orphaned 7th card */
        .metrics-row .metric-card:nth-child(7) {
          grid-column: 1 / -1;
          max-width: calc(50% - 0.4375rem);
          margin: 0 auto;
        }

        .header {
          padding: 1.25rem 1.5rem;
        }

        .header h1 {
          font-size: 1.5rem;
        }
      }

      /* Tablet: 768px - 1023px */
      @media (min-width: 768px) and (max-width: 1023px) {
        .content {
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
          padding: 1rem 1.5rem;
        }

        .metrics-row {
          grid-template-columns: repeat(2, 1fr);
          gap: 0.75rem;
          margin-bottom: 0;
        }

        /* Center and constrain the orphaned 7th card */
        .metrics-row .metric-card:nth-child(7) {
          grid-column: 1 / -1;
          max-width: calc(50% - 0.375rem);
          margin: 0 auto;
        }

        .header {
          padding: 1rem 1.5rem;
        }

        .header h1 {
          font-size: 1.35rem;
        }

        .header-desc {
          font-size: 0.8rem;
        }

        .metric-card {
          padding: 1rem;
        }

        .metric-value {
          font-size: 1.5rem;
        }

        .chart-card {
          padding: 1rem;
        }

        .chart-title {
          font-size: 0.9rem;
          margin-bottom: 0.75rem;
          padding-bottom: 0.5rem;
        }

        .chart-container {
          min-height: 180px;
        }
      }

      /* Large Mobile: 600px - 767px */
      @media (min-width: 600px) and (max-width: 767px) {
        .content {
          grid-template-columns: 1fr;
          gap: 1rem;
          padding: 1rem 1.25rem;
        }

        .metrics-row {
          grid-template-columns: repeat(2, 1fr);
          gap: 0.75rem;
        }

        /* Center and constrain the orphaned 7th card */
        .metrics-row .metric-card:nth-child(7) {
          grid-column: 1 / -1;
          max-width: calc(50% - 0.375rem);
          margin: 0 auto;
        }

        .metric-card {
          padding: 1rem;
          min-height: 90px;
        }

        .header {
          padding: 1rem 1.25rem;
        }

        .header h1 {
          font-size: 1.3rem;
        }

        .header-desc {
          font-size: 0.8rem;
        }

        .chart-card {
          padding: 1rem;
        }

        .chart-title {
          font-size: 0.9rem;
        }

        .chart-container {
          min-height: 200px;
        }
      }

      /* Mobile: 480px - 599px */
      @media (min-width: 480px) and (max-width: 599px) {
        .content {
          grid-template-columns: 1fr;
          gap: 0.875rem;
          padding: 0.875rem 1rem;
        }

        .metrics-row {
          grid-template-columns: repeat(2, 1fr);
          gap: 0.75rem;
        }

        /* Center and constrain the orphaned 7th card */
        .metrics-row .metric-card:nth-child(7) {
          grid-column: 1 / -1;
          max-width: calc(50% - 0.375rem);
          margin: 0 auto;
        }

        .header {
          padding: 0.875rem 1rem;
        }

        .header h1 {
          font-size: 1.2rem;
        }

        .header-subtitle {
          font-size: 0.8rem;
        }

        .header-desc {
          font-size: 0.75rem;
        }

        .metric-card {
          padding: 0.875rem;
        }

        .metric-value {
          font-size: 1.35rem;
        }

        .chart-card {
          padding: 0.875rem;
        }
      }

      /* Small Mobile: < 480px */
      @media (max-width: 479px) {
        .content {
          grid-template-columns: 1fr;
          padding: 0.75rem;
          gap: 0.75rem;
        }

        .metrics-row {
          grid-template-columns: 1fr;
          gap: 0.75rem;
        }

        .header {
          padding: 0.75rem;
        }

        .header h1 {
          font-size: 1.1rem;
        }

        .header-subtitle {
          font-size: 0.75rem;
        }

        .header-desc {
          font-size: 0.7rem;
        }

        .metric-card {
          min-height: 56px;
          padding: 0.75rem;
        }

        .metric-value {
          font-size: 1.25rem;
        }

        .chart-card {
          padding: 0.75rem;
        }

        .chart-title {
          font-size: 0.85rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <p class="header-desc">
          Comprehensive snapshot of the global payments industry, covering
          market outlook, investment priorities, AI adoption, workforce trends,
          and compliance costs based on latest industry surveys and research.
        </p>
      </div>

      <!-- Main Content -->
      <div class="content">
        <!-- Key Metrics -->
        <div class="metrics-row">
          <div class="metric-card">
            <div class="metric-value">55%</div>
            <div class="metric-label">Positive industry outlook</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">53%</div>
            <div class="metric-label">See AI/ML as greatest investment priority</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">18%</div>
            <div class="metric-label">
              of respondents see AI as the biggest opportunity in payments
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-value">4.76m</div>
            <div class="metric-label">roles to be filled in cybersecurity</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">$3T</div>
            <div class="metric-label">
              Global payments projected 2030 revenue
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-value">55%</div>
            <div class="metric-label">
              of respondents expect budgets to increase in the next year
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-value">45%</div>
            <div class="metric-label">
              see technological capabilities as the biggest investment priority
            </div>
          </div>
        </div>

        <!-- Budget Priorities Chart -->
        <div class="chart-card">
          <div class="chart-title">Budget investment priorities</div>
          <p style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 1rem">
            PAY360 2025 State of the Industry Survey (2025) - Investment focus
            areas
          </p>
          <div class="chart-container">
            <canvas id="budgetChart"></canvas>
          </div>
        </div>

        <!-- Industry Outlook Chart -->
        <div class="chart-card">
          <div class="chart-title">Industry sentiment 2025</div>
          <p style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 1rem">
            PAY360 2025 Survey (2025) - Business outlook for next 12 months
          </p>
          <div class="chart-container">
            <canvas id="outlookChart"></canvas>
          </div>
        </div>

        <!-- Biggest Opportunities Ahead -->
        <div class="chart-card">
          <div class="chart-title">Biggest opportunities ahead</div>
          <p style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 1rem">
            Financial crime 360 survey â€¢ Payments intelligence - Future opportunity assessment
          </p>
          <div class="chart-container">
            <canvas id="aiChart"></canvas>
          </div>
        </div>

        <!-- Challenges Trend -->
        <div class="chart-card">
          <div class="chart-title">Main industry challenges</div>
          <p style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 1rem">
            PAY360 State of Industry Survey (2023-2025) - Year-on-year
            comparison
          </p>
          <div class="chart-container">
            <canvas id="challengesChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer">
        <p>
          Data sources:
          <a
            href="https://thepaymentsassociation.org/article/2025-pay360-state-of-the-industry-survey/"
            target="_blank"
            style="
              color: #01d6b0;
              text-decoration: none;
              border-bottom: 1px solid #01d6b0;
            "
            >PAY360 2025</a
          >
          |
          <a
            href="https://thepaymentsassociation.org/article/financial-crime-360-state-of-the-industry-report-2025/"
            target="_blank"
            style="
              color: #01d6b0;
              text-decoration: none;
              border-bottom: 1px solid #01d6b0;
            "
            >Financial Crime 360</a
          >
          |
          <a
            href="https://www.isc2.org/Insights/2024/10/ISC2-2024-Cybersecurity-Workforce-Study"
            target="_blank"
            style="
              color: #01d6b0;
              text-decoration: none;
              border-bottom: 1px solid #01d6b0;
            "
            >ISC2 Cybersecurity Study</a
          >
          |
          <a
            href="https://www.mckinsey.com/industries/financial-services/our-insights/global-payments-report"
            target="_blank"
            style="
              color: #01d6b0;
              text-decoration: none;
              border-bottom: 1px solid #01d6b0;
            "
            >McKinsey Global Payments</a
          >
        </p>
      </div>
    </div>

    <script src="../static/js/data.js"></script>
    <script>
      // Chart.js Configuration
      Chart.defaults.font.family =
        "-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif";
      Chart.defaults.color = "#E0E0E0";
      Chart.defaults.borderColor = "#4A5668";

      const chartColors = {
        primary: "#01D6B0",
        secondary: "#00B399",
        tertiary: "#008B7A",
        quaternary: "#006B5F",
        light: "#01F0C7",
        // Enhanced multi-step green gradient for better visual distinction between bars
        greenVariants: [
          "#004F47", // Very dark green (darkest)
          "#006B5F", // Dark green
          "#008878", // Medium-dark green
          "#00A896", // Medium green
          "#00C4AB", // Medium-bright green
          "#01D6B0", // Bright teal-green
          "#01E5BB", // Brighter green
          "#01F0C7", // Brightest pale green
          "#20F5D1", // Ultra bright green (additional for more bars)
          "#3AF9D9", // Super bright (10+ bars)
        ],
        variants: [
          "#01D6B0",
          "#00B399",
          "#008B7A",
          "#006B5F",
          "#01F0C7",
          "#00B39F",
        ],
        text: "#FFFFFF",
        textSecondary: "#E0E0E0",
      };

      // 1. Budget Priorities Chart
      const budgetCtx = document.getElementById("budgetChart");
      if (budgetCtx) {
        const isMobileBudget = window.innerWidth <= 768;
        new Chart(budgetCtx, {
          type: "bar",
          plugins: isMobileBudget ? [ChartDataLabels] : [],
          data: {
            labels: [
              "AI",
              "Cross-border\npayments",
              "Real-time\npayments",
              "Customer experience",
              "Embedded\ncommerce",
              "Open banking",
              "Other",
              "Digital currencies",
              "Digital wallets",
              "Blockchain\ntechnology",
              "Financial inclusion\n& ESG",
            ],
            datasets: [
              {
                data: [18, 12, 12, 11, 10, 8, 8, 7, 6, 4, 4],
                backgroundColor: chartColors.greenVariants.slice(0, 11),
                borderRadius: 5,
                borderWidth: 0,
              },
            ],
          },
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: "#323D4D",
                padding: 10,
                titleColor: "#FFFFFF",
                bodyColor: "#E0E0E0",
                borderColor: "#01D6B0",
                borderWidth: 1,
                callbacks: {
                  label: (context) => Math.round(context.parsed.x) + "%",
                },
              },
              datalabels: {
                display: isMobileBudget,
                color: "#FFFFFF",
                font: {
                  size: window.innerWidth <= 480 ? 8 : 10,
                  weight: "bold",
                },
                formatter: (value) => {
                  return value >= 4 ? Math.round(value) + "%" : "";
                },
                anchor: "end",
                align: "right",
              },
            },
            scales: {
              x: {
                beginAtZero: true,
                max: 20,
                grid: { color: "#3A4655" },
                ticks: {
                  color: "#E0E0E0",
                  font: { size: 12 },
                  callback: (value) => value + "%",
                },
              },
              y: {
                grid: { display: false },
                ticks: { color: "#E0E0E0", font: { size: 12, weight: "500" } },
              },
            },
          },
        });
      }

      // 2. Industry Outlook Chart
      const outlookCtx = document.getElementById("outlookChart");
      if (outlookCtx) {
        new Chart(outlookCtx, {
          type: "doughnut",
          plugins: [],
          data: {
            labels: ["Positive", "Very Positive", "Neutral", "Negative"],
            datasets: [
              {
                data: [55, 20, 20, 4],
                backgroundColor: [
                  chartColors.primary,
                  chartColors.light,
                  chartColors.secondary,
                  "#4A5668",
                ],
                borderColor: "#323D4D",
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 12,
                  font: { size: 10, weight: "500" },
                  color: "#E0E0E0",
                },
              },
              tooltip: {
                backgroundColor: "#323D4D",
                padding: 10,
                titleColor: "#FFFFFF",
                bodyColor: "#E0E0E0",
                borderColor: "#01D6B0",
                borderWidth: 1,
                callbacks: {
                  label: (context) =>
                    context.label + ": " + context.parsed + "%",
                },
              },
            },
          },
        });
      }

      // 3. Biggest Opportunities Ahead Chart
      const aiCtx = document.getElementById("aiChart");
      if (aiCtx) {
        const isMobileAI = window.innerWidth <= 768;
        new Chart(aiCtx, {
          type: "bar",
          plugins: isMobileAI ? [ChartDataLabels] : [],
          data: {
            labels: [
              "Other",
              "AI",
              "Digital currencies",
              "Cross-border\npayments",
              "Open Banking",
              "Real-time\npayments",
              "Embedded\ncommerce",
              "Digital wallets",
            ],
            datasets: [
              {
                data: [35, 24, 7, 5, 3, 3, 2, 2],
                backgroundColor: chartColors.greenVariants.slice(0, 8),
                borderRadius: 5,
                borderWidth: 0,
              },
            ],
          },
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: "#323D4D",
                padding: 10,
                titleColor: "#FFFFFF",
                bodyColor: "#E0E0E0",
                borderColor: "#01D6B0",
                borderWidth: 1,
                callbacks: {
                  label: (context) => Math.round(context.parsed.x) + "%",
                },
              },
              datalabels: {
                display: isMobileAI,
                color: "#FFFFFF",
                font: {
                  size: window.innerWidth <= 480 ? 8 : 10,
                  weight: "bold",
                },
                formatter: (value) => {
                  return value >= 2 ? Math.round(value) + "%" : "";
                },
                anchor: "end",
                align: "right",
              },
            },
            scales: {
              x: {
                beginAtZero: true,
                max: 40,
                grid: { color: "#3A4655" },
                ticks: {
                  color: "#E0E0E0",
                  font: { size: 12 },
                  callback: (value) => value + "%",
                },
              },
              y: {
                grid: { display: false },
                ticks: { color: "#E0E0E0", font: { size: 12, weight: "500" } },
              },
            },
          },
        });
      }

      // 4. Challenges Trend Chart
      const challengesCtx = document.getElementById("challengesChart");
      if (challengesCtx) {
        new Chart(challengesCtx, {
          type: "line",
          plugins: [],
          data: {
            labels: ["2023", "2024", "2025"],
            datasets: [
              {
                label: "Financial Crime & Cybersecurity",
                data: [21, 28, 30],
                borderColor: chartColors.primary,
                backgroundColor: chartColors.primary + "10",
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: chartColors.primary,
                pointBorderColor: "#323D4D",
                pointBorderWidth: 2,
                tension: 0.4,
                fill: false,
              },
              {
                label: "Compliance",
                data: [25, 18, 16],
                borderColor: chartColors.secondary,
                backgroundColor: chartColors.secondary + "10",
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: chartColors.secondary,
                pointBorderColor: "#323D4D",
                pointBorderWidth: 2,
                tension: 0.4,
                fill: false,
              },
              {
                label: "Digital Transformation",
                data: [14, 10, 13],
                borderColor: chartColors.tertiary,
                backgroundColor: chartColors.tertiary + "10",
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: chartColors.tertiary,
                pointBorderColor: "#323D4D",
                pointBorderWidth: 2,
                tension: 0.4,
                fill: false,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 10,
                  font: { size: 10, weight: "500" },
                  color: "#E0E0E0",
                },
              },
              tooltip: {
                backgroundColor: "#323D4D",
                padding: 10,
                titleColor: "#FFFFFF",
                bodyColor: "#E0E0E0",
                borderColor: "#01D6B0",
                borderWidth: 1,
                callbacks: {
                  label: (context) =>
                    context.dataset.label + ": " + context.parsed.y + "%",
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 35,
                grid: { color: "#3A4655" },
                ticks: {
                  color: "#E0E0E0",
                  font: { size: 13 },
                  callback: (value) => value + "%",
                },
              },
              x: {
                grid: { display: false },
                ticks: { color: "#E0E0E0", font: { size: 12, weight: "500" } },
              },
            },
          },
        });
      }

      // Store chart instances for resize handling
      let chartInstances = {
        budget: null,
        outlook: null,
        ai: null,
        challenges: null
      };

      // Initialize all charts
      function initializeCharts() {
        const isMobileBudget = window.innerWidth <= 768;
        const isMobileAI = window.innerWidth <= 768;

        // Destroy existing charts if they exist (prevents "Canvas already in use" error)
        if (chartInstances.budget) {
          chartInstances.budget.destroy();
          chartInstances.budget = null;
        }
        if (chartInstances.outlook) {
          chartInstances.outlook.destroy();
          chartInstances.outlook = null;
        }
        if (chartInstances.ai) {
          chartInstances.ai.destroy();
          chartInstances.ai = null;
        }
        if (chartInstances.challenges) {
          chartInstances.challenges.destroy();
          chartInstances.challenges = null;
        }

        // Also check if Chart.js has any charts on these canvases and destroy them
        ['budgetChart', 'outlookChart', 'aiChart', 'challengesChart'].forEach(function(canvasId) {
          const canvas = document.getElementById(canvasId);
          if (canvas) {
            const existingChart = Chart.getChart(canvas);
            if (existingChart) {
              existingChart.destroy();
            }
          }
        });

        // 1. Budget Priorities Chart
        const budgetCtx = document.getElementById("budgetChart");
        if (budgetCtx) {
          chartInstances.budget = new Chart(budgetCtx, {
            type: "bar",
            plugins: isMobileBudget ? [ChartDataLabels] : [],
            data: {
              labels: [
                "AI",
                "Cross-border\npayments",
                "Real-time\npayments",
                "Customer experience",
                "Embedded\ncommerce",
                "Open banking",
                "Other",
                "Digital currencies",
                "Digital wallets",
                "Blockchain\ntechnology",
                "Financial inclusion\n& ESG",
              ],
              datasets: [
                {
                  data: [18, 12, 12, 11, 10, 8, 8, 7, 6, 4, 4],
                  backgroundColor: chartColors.greenVariants.slice(0, 11),
                  borderRadius: 5,
                  borderWidth: 0,
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: "#323D4D",
                  padding: 10,
                  titleColor: "#FFFFFF",
                  bodyColor: "#E0E0E0",
                  borderColor: "#01D6B0",
                  borderWidth: 1,
                  callbacks: {
                    label: (context) => Math.round(context.parsed.x) + "%",
                  },
                },
                datalabels: {
                  display: isMobileBudget,
                  color: "#FFFFFF",
                  font: {
                    size: window.innerWidth <= 480 ? 8 : 10,
                    weight: "bold",
                  },
                  formatter: (value) => {
                    return value >= 4 ? Math.round(value) + "%" : "";
                  },
                  anchor: "end",
                  align: "right",
                },
              },
              scales: {
                x: {
                  beginAtZero: true,
                  max: 20,
                  grid: { color: "#3A4655" },
                  ticks: {
                    color: "#E0E0E0",
                    font: { size: 12 },
                    callback: (value) => value + "%",
                  },
                },
                y: {
                  grid: { display: false },
                  ticks: { color: "#E0E0E0", font: { size: 12, weight: "500" } },
                },
              },
            },
          });
        }

        // 2. Industry Outlook Chart
        const outlookCtx = document.getElementById("outlookChart");
        if (outlookCtx) {
          chartInstances.outlook = new Chart(outlookCtx, {
            type: "doughnut",
            plugins: [],
            data: {
              labels: ["Positive", "Very Positive", "Neutral", "Negative"],
              datasets: [
                {
                  data: [55, 20, 20, 4],
                  backgroundColor: [
                    chartColors.primary,
                    chartColors.light,
                    chartColors.secondary,
                    "#4A5668",
                  ],
                  borderColor: "#323D4D",
                  borderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "bottom",
                  labels: {
                    padding: 12,
                    font: { size: 10, weight: "500" },
                    color: "#E0E0E0",
                  },
                },
                tooltip: {
                  backgroundColor: "#323D4D",
                  padding: 10,
                  titleColor: "#FFFFFF",
                  bodyColor: "#E0E0E0",
                  borderColor: "#01D6B0",
                  borderWidth: 1,
                  callbacks: {
                    label: (context) =>
                      context.label + ": " + context.parsed + "%",
                  },
                },
              },
            },
          });
        }

        // 3. Biggest Opportunities Ahead Chart
        const aiCtx = document.getElementById("aiChart");
        if (aiCtx) {
          chartInstances.ai = new Chart(aiCtx, {
            type: "bar",
            plugins: isMobileAI ? [ChartDataLabels] : [],
            data: {
              labels: [
                "Other",
                "AI",
                "Digital currencies",
                "Cross-border\npayments",
                "Open Banking",
                "Real-time\npayments",
                "Embedded\ncommerce",
                "Digital wallets",
              ],
              datasets: [
                {
                  data: [35, 24, 7, 5, 3, 3, 2, 2],
                  backgroundColor: chartColors.greenVariants.slice(0, 8),
                  borderRadius: 5,
                  borderWidth: 0,
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: "#323D4D",
                  padding: 10,
                  titleColor: "#FFFFFF",
                  bodyColor: "#E0E0E0",
                  borderColor: "#01D6B0",
                  borderWidth: 1,
                  callbacks: {
                    label: (context) => Math.round(context.parsed.x) + "%",
                  },
                },
                datalabels: {
                  display: isMobileAI,
                  color: "#FFFFFF",
                  font: {
                    size: window.innerWidth <= 480 ? 8 : 10,
                    weight: "bold",
                  },
                  formatter: (value) => {
                    return value >= 2 ? Math.round(value) + "%" : "";
                  },
                  anchor: "end",
                  align: "right",
                },
              },
              scales: {
                x: {
                  beginAtZero: true,
                  max: 40,
                  grid: { color: "#3A4655" },
                  ticks: {
                    color: "#E0E0E0",
                    font: { size: 12 },
                    callback: (value) => value + "%",
                  },
                },
                y: {
                  grid: { display: false },
                  ticks: { color: "#E0E0E0", font: { size: 12, weight: "500" } },
                },
              },
            },
          });
        }

        // 4. Challenges Trend Chart
        const challengesCtx = document.getElementById("challengesChart");
        if (challengesCtx) {
          chartInstances.challenges = new Chart(challengesCtx, {
            type: "line",
            plugins: [],
            data: {
              labels: ["2023", "2024", "2025"],
              datasets: [
                {
                  label: "Financial Crime & Cybersecurity",
                  data: [21, 28, 30],
                  borderColor: chartColors.primary,
                  backgroundColor: chartColors.primary + "10",
                  borderWidth: 3,
                  pointRadius: 4,
                  pointBackgroundColor: chartColors.primary,
                  pointBorderColor: "#323D4D",
                  pointBorderWidth: 2,
                  tension: 0.4,
                  fill: false,
                },
                {
                  label: "Compliance",
                  data: [25, 18, 16],
                  borderColor: chartColors.secondary,
                  backgroundColor: chartColors.secondary + "10",
                  borderWidth: 3,
                  pointRadius: 4,
                  pointBackgroundColor: chartColors.secondary,
                  pointBorderColor: "#323D4D",
                  pointBorderWidth: 2,
                  tension: 0.4,
                  fill: false,
                },
                {
                  label: "Digital Transformation",
                  data: [14, 10, 13],
                  borderColor: chartColors.tertiary,
                  backgroundColor: chartColors.tertiary + "10",
                  borderWidth: 3,
                  pointRadius: 4,
                  pointBackgroundColor: chartColors.tertiary,
                  pointBorderColor: "#323D4D",
                  pointBorderWidth: 2,
                  tension: 0.4,
                  fill: false,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "bottom",
                  labels: {
                    padding: 10,
                    font: { size: 10, weight: "500" },
                    color: "#E0E0E0",
                  },
                },
                tooltip: {
                  backgroundColor: "#323D4D",
                  padding: 10,
                  titleColor: "#FFFFFF",
                  bodyColor: "#E0E0E0",
                  borderColor: "#01D6B0",
                  borderWidth: 1,
                  callbacks: {
                    label: (context) =>
                      context.dataset.label + ": " + context.parsed.y + "%",
                  },
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 35,
                  grid: { color: "#3A4655" },
                  ticks: {
                    color: "#E0E0E0",
                    font: { size: 13 },
                    callback: (value) => value + "%",
                  },
                },
                x: {
                  grid: { display: false },
                  ticks: { color: "#E0E0E0", font: { size: 12, weight: "500" } },
                },
              },
            },
          });
        }
      }

      // Track current breakpoint for height updates
      let currentBreakpoint = window.innerWidth <= 768 ? 'mobile' : 'desktop';

      // Initialize charts on page load
      initializeCharts();

      // Handle window resize with debouncing - ALWAYS rebuild for smooth resizing
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
          // Always rebuild charts on ANY resize/zoom for smooth, consistent rendering
          initializeCharts();
          console.log('Charts rebuilt - smooth resize');

          // Only send height when breakpoint changes (prevents iframe loop)
          const newBreakpoint = window.innerWidth <= 768 ? 'mobile' : 'desktop';
          if (newBreakpoint !== currentBreakpoint) {
            currentBreakpoint = newBreakpoint;
            setTimeout(sendHeightToParent, 100);
            console.log('Breakpoint changed to:', currentBreakpoint);
          }
        }, 250); // Debounce for 250ms
      });

      // Function to calculate and send height to parent iframe
      let lastSentHeight = 0; // Track last sent height to prevent infinite loops

      function sendHeightToParent() {
        // Get the actual height of the document
        const body = document.body;
        const html = document.documentElement;
        const height = Math.max(
          body.scrollHeight,
          body.offsetHeight,
          html.clientHeight,
          html.scrollHeight,
          html.offsetHeight
        );

        // Only send if height changed by more than 50px (prevents mini-loops from padding)
        if (Math.abs(height - lastSentHeight) > 50) {
          lastSentHeight = height;

          // Send message to parent window
          if (window.parent !== window) {
            window.parent.postMessage({
              type: 'dashboard-height',
              height: height,
              dashboard: 'industry-outlook'
            }, '*');
            console.log('Sent height to parent:', height + 'px');
          }
        }
      }

      // Send initial height after charts are loaded
      // Longer delay to ensure parent listener is ready
      setTimeout(sendHeightToParent, 1500);

      // Also send height when images or content loads
      window.addEventListener('load', function() {
        setTimeout(sendHeightToParent, 1000);
      });

      console.log('Industry outlook dashboard charts initialized');
    </script>
  </body>
</html>
