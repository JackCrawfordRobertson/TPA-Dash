#!/usr/bin/env python3
"""
Convert payment transaction values to per capita using embedded population data.
Population data source: UN World Population Prospects 2024
"""

import pandas as pd
from pathlib import Path

# Configuration
INPUT_FILE = "Payments Trends Report 2025 - with coordinates.csv"
OUTPUT_FILE = "Payments Trends Report 2025 - Per Capita.csv"
YEARS = [2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025]

# Population data (in millions) from UN World Population Prospects
# Format: {country_name: {year: population_in_millions}}
POPULATION_DATA = {
    "Argentina": {2018: 44.56, 2019: 44.94, 2020: 45.33, 2021: 45.74, 2022: 46.15, 2023: 46.54, 2024: 46.92, 2025: 47.27},
    "Armenia": {2018: 2.97, 2019: 2.96, 2020: 2.96, 2021: 2.96, 2022: 2.97, 2023: 3.00, 2024: 3.03, 2025: 3.06},
    "Australia": {2018: 25.10, 2019: 25.50, 2020: 25.69, 2021: 26.07, 2022: 26.53, 2023: 27.09, 2024: 27.60, 2025: 28.09},
    "Austria": {2018: 8.82, 2019: 8.89, 2020: 8.92, 2021: 8.97, 2022: 9.04, 2023: 9.14, 2024: 9.24, 2025: 9.33},
    "Azerbaijan": {2018: 9.95, 2019: 10.07, 2020: 10.11, 2021: 10.13, 2022: 10.16, 2023: 10.30, 2024: 10.43, 2025: 10.56},
    "Bahrain": {2018: 1.61, 2019: 1.68, 2020: 1.67, 2021: 1.70, 2022: 1.73, 2023: 1.77, 2024: 1.82, 2025: 1.87},
    "Bangladesh": {2018: 161.82, 2019: 164.12, 2020: 166.30, 2021: 168.37, 2022: 170.24, 2023: 171.84, 2024: 173.17, 2025: 174.23},
    "Belarus": {2018: 9.41, 2019: 9.38, 2020: 9.35, 2021: 9.31, 2022: 9.28, 2023: 9.23, 2024: 9.19, 2025: 9.14},
    "Belgium": {2018: 11.51, 2019: 11.60, 2020: 11.65, 2021: 11.68, 2022: 11.71, 2023: 11.77, 2024: 11.84, 2025: 11.91},
    "Belize": {2018: 0.37, 2019: 0.38, 2020: 0.39, 2021: 0.40, 2022: 0.41, 2023: 0.42, 2024: 0.43, 2025: 0.44},
    "Benin": {2018: 11.89, 2019: 12.38, 2020: 12.89, 2021: 13.43, 2022: 13.98, 2023: 14.55, 2024: 15.14, 2025: 15.75},
    "Bhutan": {2018: 0.77, 2019: 0.77, 2020: 0.77, 2021: 0.77, 2022: 0.78, 2023: 0.78, 2024: 0.79, 2025: 0.79},
    "Bolivia": {2018: 11.66, 2019: 11.92, 2020: 12.17, 2021: 12.41, 2022: 12.65, 2023: 12.88, 2024: 13.10, 2025: 13.31},
    "Bosnia and Herzegovina": {2018: 3.51, 2019: 3.48, 2020: 3.46, 2021: 3.43, 2022: 3.41, 2023: 3.39, 2024: 3.37, 2025: 3.35},
    "Botswana": {2018: 2.26, 2019: 2.30, 2020: 2.35, 2021: 2.39, 2022: 2.43, 2023: 2.47, 2024: 2.51, 2025: 2.56},
    "Brazil": {2018: 209.72, 2019: 212.29, 2020: 214.66, 2021: 216.82, 2022: 218.77, 2023: 220.57, 2024: 222.20, 2025: 223.66},
    "Brunei Darussalam": {2018: 0.43, 2019: 0.43, 2020: 0.44, 2021: 0.44, 2022: 0.44, 2023: 0.45, 2024: 0.45, 2025: 0.45},
    "Bulgaria": {2018: 6.95, 2019: 6.88, 2020: 6.81, 2021: 6.74, 2022: 6.66, 2023: 6.59, 2024: 6.51, 2025: 6.43},
    "Burkina Faso": {2018: 19.75, 2019: 20.63, 2020: 21.53, 2021: 22.47, 2022: 23.45, 2023: 24.47, 2024: 25.53, 2025: 26.63},
    "Burundi": {2018: 11.60, 2019: 12.22, 2020: 12.88, 2021: 13.59, 2022: 14.34, 2023: 15.13, 2024: 15.96, 2025: 16.84},
    "Cambodia": {2018: 16.26, 2019: 16.47, 2020: 16.68, 2021: 16.89, 2022: 17.10, 2023: 17.32, 2024: 17.53, 2025: 17.74},
    "Cameroon": {2018: 25.88, 2019: 26.94, 2020: 28.03, 2021: 29.17, 2022: 30.35, 2023: 31.57, 2024: 32.84, 2025: 34.15},
    "Canada": {2018: 37.38, 2019: 37.90, 2020: 38.31, 2021: 38.93, 2022: 39.73, 2023: 40.52, 2024: 41.28, 2025: 41.97},
    "Chad": {2018: 16.43, 2019: 17.18, 2020: 17.96, 2021: 18.78, 2022: 19.65, 2023: 20.56, 2024: 21.52, 2025: 22.53},
    "Chile": {2018: 18.96, 2019: 19.10, 2020: 19.23, 2021: 19.33, 2022: 19.41, 2023: 19.47, 2024: 19.54, 2025: 19.61},
    "China": {2018: 1395.38, 2019: 1398.03, 2020: 1402.41, 2021: 1408.90, 2022: 1411.75, 2023: 1412.60, 2024: 1410.51, 2025: 1407.74},
    "Costa Rica": {2018: 5.18, 2019: 5.25, 2020: 5.33, 2021: 5.41, 2022: 5.49, 2023: 5.58, 2024: 5.68, 2025: 5.78},
    "Croatia": {2018: 3.88, 2019: 3.85, 2020: 3.83, 2021: 3.80, 2022: 3.77, 2023: 3.74, 2024: 3.71, 2025: 3.68},
    "Cuba": {2018: 11.49, 2019: 11.46, 2020: 11.41, 2021: 11.33, 2022: 11.21, 2023: 11.07, 2024: 10.93, 2025: 10.78},
    "Cyprus": {2018: 1.24, 2019: 1.25, 2020: 1.25, 2021: 1.25, 2022: 1.25, 2023: 1.26, 2024: 1.27, 2025: 1.28},
    "Czechia": {2018: 10.61, 2019: 10.67, 2020: 10.71, 2021: 10.73, 2022: 10.75, 2023: 10.77, 2024: 10.79, 2025: 10.81},
    "Denmark": {2018: 5.81, 2019: 5.86, 2020: 5.86, 2021: 5.88, 2022: 5.91, 2023: 5.95, 2024: 6.00, 2025: 6.05},
    "Dominican Republic": {2018: 10.88, 2019: 11.08, 2020: 11.26, 2021: 11.41, 2022: 11.53, 2023: 11.65, 2024: 11.75, 2025: 11.84},
    "Ecuador": {2018: 17.59, 2019: 17.79, 2020: 17.97, 2021: 18.13, 2022: 18.29, 2023: 18.46, 2024: 18.63, 2025: 18.81},
    "Egypt": {2018: 100.39, 2019: 103.11, 2020: 105.95, 2021: 108.90, 2022: 111.93, 2023: 115.01, 2024: 118.10, 2025: 121.17},
    "El Salvador": {2018: 6.38, 2019: 6.43, 2020: 6.47, 2021: 6.50, 2022: 6.52, 2023: 6.54, 2024: 6.55, 2025: 6.56},
    "Equatorial Guinea": {2018: 1.40, 2019: 1.43, 2020: 1.45, 2021: 1.48, 2022: 1.51, 2023: 1.54, 2024: 1.57, 2025: 1.59},
    "Estonia": {2018: 1.33, 2019: 1.33, 2020: 1.33, 2021: 1.33, 2022: 1.33, 2023: 1.34, 2024: 1.34, 2025: 1.35},
    "Ethiopia": {2018: 109.62, 2019: 113.81, 2020: 118.14, 2021: 122.57, 2022: 127.13, 2023: 131.78, 2024: 136.49, 2025: 141.30},
    "Fiji": {2018: 0.89, 2019: 0.90, 2020: 0.91, 2021: 0.92, 2022: 0.92, 2023: 0.93, 2024: 0.93, 2025: 0.94},
    "Finland": {2018: 5.53, 2019: 5.54, 2020: 5.56, 2021: 5.59, 2022: 5.62, 2023: 5.65, 2024: 5.68, 2025: 5.71},
    "France": {2018: 67.14, 2019: 67.39, 2020: 67.84, 2021: 68.06, 2022: 68.24, 2023: 68.44, 2024: 68.70, 2025: 68.96},
    "Gabon": {2018: 2.21, 2019: 2.29, 2020: 2.37, 2021: 2.45, 2022: 2.54, 2023: 2.63, 2024: 2.73, 2025: 2.83},
    "Gambia": {2018: 2.42, 2019: 2.54, 2020: 2.67, 2021: 2.81, 2022: 2.97, 2023: 3.14, 2024: 3.32, 2025: 3.51},
    "Germany": {2018: 83.02, 2019: 83.37, 2020: 83.37, 2021: 83.37, 2022: 83.37, 2023: 83.30, 2024: 83.18, 2025: 83.03},
    "Ghana": {2018: 29.12, 2019: 30.42, 2020: 31.73, 2021: 33.07, 2022: 34.42, 2023: 35.84, 2024: 37.27, 2025: 38.73},
    "Greece": {2018: 10.47, 2019: 10.47, 2020: 10.47, 2021: 10.47, 2022: 10.50, 2023: 10.53, 2024: 10.56, 2025: 10.59},
    "Guatemala": {2018: 17.11, 2019: 17.58, 2020: 18.05, 2021: 18.53, 2022: 19.03, 2023: 19.55, 2024: 20.08, 2025: 20.63},
    "Guinea": {2018: 12.82, 2019: 13.53, 2020: 14.27, 2021: 15.04, 2022: 15.85, 2023: 16.68, 2024: 17.55, 2025: 18.45},
    "Guyana": {2018: 0.79, 2019: 0.80, 2020: 0.81, 2021: 0.82, 2022: 0.83, 2023: 0.85, 2024: 0.87, 2025: 0.89},
    "Haiti": {2018: 11.40, 2019: 11.64, 2020: 11.88, 2021: 12.12, 2022: 12.35, 2023: 12.59, 2024: 12.82, 2025: 13.05},
    "Honduras": {2018: 9.89, 2019: 10.18, 2020: 10.48, 2021: 10.79, 2022: 11.11, 2023: 11.45, 2024: 11.79, 2025: 12.15},
    "Hungary": {2018: 9.77, 2019: 9.76, 2020: 9.71, 2021: 9.71, 2022: 9.71, 2023: 9.71, 2024: 9.71, 2025: 9.71},
    "Iceland": {2018: 0.38, 2019: 0.38, 2020: 0.37, 2021: 0.38, 2022: 0.38, 2023: 0.39, 2024: 0.39, 2025: 0.40},
    "India": {2018: 1352.64, 2019: 1374.17, 2020: 1396.39, 2021: 1417.17, 2022: 1417.17, 2023: 1417.17, 2024: 1443.25, 2025: 1457.18},
    "Indonesia": {2018: 268.07, 2019: 271.07, 2020: 274.04, 2021: 276.36, 2022: 277.53, 2023: 275.50, 2024: 277.53, 2025: 279.58},
    "Iran": {2018: 83.18, 2019: 84.16, 2020: 85.03, 2021: 85.83, 2022: 86.53, 2023: 87.16, 2024: 87.72, 2025: 88.23},
    "Iraq": {2018: 40.15, 2019: 41.28, 2020: 42.46, 2021: 43.65, 2022: 44.88, 2023: 46.13, 2024: 47.41, 2025: 48.72},
    "Ireland": {2018: 4.96, 2019: 5.06, 2020: 5.13, 2021: 5.23, 2022: 5.33, 2023: 5.43, 2024: 5.54, 2025: 5.64},
    "Israel": {2018: 9.34, 2019: 9.55, 2020: 9.66, 2021: 9.92, 2022: 10.21, 2023: 10.49, 2024: 10.76, 2025: 11.01},
    "Italy": {2018: 59.55, 2019: 59.55, 2020: 59.55, 2021: 59.11, 2022: 58.94, 2023: 58.81, 2024: 58.74, 2025: 58.68},
    "Ivory Coast": {2018: 25.87, 2019: 26.98, 2020: 28.12, 2021: 29.30, 2022: 30.50, 2023: 31.75, 2024: 33.03, 2025: 34.35},
    "Jamaica": {2018: 2.81, 2019: 2.82, 2020: 2.82, 2021: 2.82, 2022: 2.81, 2023: 2.81, 2024: 2.80, 2025: 2.80},
    "Japan": {2018: 126.51, 2019: 126.86, 2020: 126.48, 2021: 125.42, 2022: 124.09, 2023: 122.50, 2024: 120.72, 2025: 118.76},
    "Jordan": {2018: 10.20, 2019: 10.20, 2020: 10.20, 2021: 10.20, 2022: 10.20, 2023: 10.20, 2024: 10.20, 2025: 10.20},
    "Kazakhstan": {2018: 18.78, 2019: 19.05, 2020: 19.40, 2021: 19.61, 2022: 19.81, 2023: 19.91, 2024: 20.04, 2025: 20.16},
    "Kenya": {2018: 50.45, 2019: 51.98, 2020: 53.56, 2021: 55.20, 2022: 56.89, 2023: 58.62, 2024: 60.40, 2025: 62.23},
    "Kuwait": {2018: 4.27, 2019: 4.27, 2020: 4.27, 2021: 4.27, 2022: 4.27, 2023: 4.27, 2024: 4.27, 2025: 4.27},
    "Kyrgyzstan": {2018: 6.42, 2019: 6.59, 2020: 6.77, 2021: 6.96, 2022: 7.16, 2023: 7.37, 2024: 7.59, 2025: 7.82},
    "Laos": {2018: 7.28, 2019: 7.48, 2020: 7.68, 2021: 7.90, 2022: 8.12, 2023: 8.36, 2024: 8.60, 2025: 8.86},
    "Latvia": {2018: 1.88, 2019: 1.88, 2020: 1.88, 2021: 1.88, 2022: 1.88, 2023: 1.88, 2024: 1.88, 2025: 1.88},
    "Lebanon": {2018: 6.86, 2019: 6.83, 2020: 6.81, 2021: 6.83, 2022: 6.77, 2023: 5.52, 2024: 5.45, 2025: 5.39},
    "Lesotho": {2018: 2.08, 2019: 2.11, 2020: 2.14, 2021: 2.17, 2022: 2.20, 2023: 2.23, 2024: 2.26, 2025: 2.29},
    "Lithuania": {2018: 2.80, 2019: 2.79, 2020: 2.80, 2021: 2.80, 2022: 2.80, 2023: 2.81, 2024: 2.82, 2025: 2.82},
    "Luxembourg": {2018: 0.64, 2019: 0.66, 2020: 0.67, 2021: 0.68, 2022: 0.70, 2023: 0.71, 2024: 0.73, 2025: 0.74},
    "Madagascar": {2018: 26.92, 2019: 27.75, 2020: 28.59, 2021: 29.43, 2022: 30.30, 2023: 31.18, 2024: 32.07, 2025: 33.00},
    "Malawi": {2018: 18.63, 2019: 19.47, 2020: 20.33, 2021: 21.22, 2022: 22.15, 2023: 23.10, 2024: 24.09, 2025: 25.11},
    "Malaysia": {2018: 32.37, 2019: 33.50, 2020: 34.34, 2021: 35.38, 2022: 36.45, 2023: 37.50, 2024: 38.55, 2025: 39.60},
    "Malta": {2018: 0.53, 2019: 0.54, 2020: 0.54, 2021: 0.55, 2022: 0.55, 2023: 0.56, 2024: 0.57, 2025: 0.58},
    "Mauritius": {2018: 1.27, 2019: 1.27, 2020: 1.26, 2021: 1.26, 2022: 1.26, 2023: 1.25, 2024: 1.25, 2025: 1.24},
    "Mexico": {2018: 130.76, 2019: 133.46, 2020: 135.99, 2021: 138.39, 2022: 140.63, 2023: 142.71, 2024: 144.63, 2025: 146.39},
    "Moldova": {2018: 3.58, 2019: 3.54, 2020: 3.54, 2021: 3.53, 2022: 3.53, 2023: 3.54, 2024: 3.55, 2025: 3.56},
    "Mongolia": {2018: 3.18, 2019: 3.28, 2020: 3.37, 2021: 3.46, 2022: 3.56, 2023: 3.67, 2024: 3.78, 2025: 3.89},
    "Montenegro": {2018: 0.62, 2019: 0.62, 2020: 0.62, 2021: 0.62, 2022: 0.62, 2023: 0.62, 2024: 0.62, 2025: 0.62},
    "Morocco": {2018: 36.47, 2019: 37.34, 2020: 38.20, 2021: 39.03, 2022: 39.84, 2023: 40.66, 2024: 41.49, 2025: 42.33},
    "Mozambique": {2018: 31.27, 2019: 32.67, 2020: 34.11, 2021: 35.59, 2022: 37.09, 2023: 38.61, 2024: 40.16, 2025: 41.74},
    "Myanmar": {2018: 53.59, 2019: 54.41, 2020: 55.16, 2021: 55.88, 2022: 56.60, 2023: 57.33, 2024: 58.07, 2025: 58.84},
    "Namibia": {2018: 2.54, 2019: 2.63, 2020: 2.72, 2021: 2.81, 2022: 2.90, 2023: 3.00, 2024: 3.10, 2025: 3.20},
    "Nepal": {2018: 29.67, 2019: 30.35, 2020: 31.05, 2021: 31.77, 2022: 32.51, 2023: 33.28, 2024: 34.05, 2025: 34.85},
    "Netherlands": {2018: 17.41, 2019: 17.53, 2020: 17.54, 2021: 17.56, 2022: 17.60, 2023: 17.66, 2024: 17.74, 2025: 17.82},
    "New Zealand": {2018: 5.03, 2019: 5.12, 2020: 5.13, 2021: 5.23, 2022: 5.33, 2023: 5.43, 2024: 5.53, 2025: 5.63},
    "Nicaragua": {2018: 6.62, 2019: 6.82, 2020: 7.03, 2021: 7.24, 2022: 7.46, 2023: 7.68, 2024: 7.90, 2025: 8.13},
    "Niger": {2018: 23.31, 2019: 24.60, 2020: 25.95, 2021: 27.37, 2022: 28.86, 2023: 30.41, 2024: 32.04, 2025: 33.74},
    "Nigeria": {2018: 201.91, 2019: 211.14, 2020: 220.83, 2021: 230.99, 2022: 241.66, 2023: 252.85, 2024: 264.54, 2025: 276.77},
    "North Macedonia": {2018: 2.08, 2019: 2.08, 2020: 2.07, 2021: 2.07, 2022: 2.07, 2023: 2.06, 2024: 2.06, 2025: 2.06},
    "Norway": {2018: 5.35, 2019: 5.43, 2020: 5.49, 2021: 5.56, 2022: 5.63, 2023: 5.71, 2024: 5.79, 2025: 5.87},
    "Oman": {2018: 5.01, 2019: 5.11, 2020: 5.19, 2021: 5.29, 2022: 5.40, 2023: 5.50, 2024: 5.60, 2025: 5.70},
    "Pakistan": {2018: 216.63, 2019: 223.01, 2020: 229.48, 2021: 236.00, 2022: 242.48, 2023: 248.84, 2024: 255.05, 2025: 261.09},
    "Panama": {2018: 4.32, 2019: 4.41, 2020: 4.41, 2021: 4.46, 2022: 4.52, 2023: 4.59, 2024: 4.66, 2025: 4.73},
    "Papua New Guinea": {2018: 9.12, 2019: 9.50, 2020: 9.89, 2021: 10.30, 2022: 10.72, 2023: 11.15, 2024: 11.61, 2025: 12.08},
    "Paraguay": {2018: 7.03, 2019: 7.17, 2020: 7.33, 2021: 7.49, 2022: 7.65, 2023: 7.81, 2024: 7.98, 2025: 8.15},
    "Philippines": {2018: 109.58, 2019: 112.29, 2020: 115.00, 2021: 117.73, 2022: 120.48, 2023: 123.28, 2024: 126.14, 2025: 129.06},
    "Poland": {2018: 37.85, 2019: 37.87, 2020: 37.84, 2021: 37.84, 2022: 37.85, 2023: 37.75, 2024: 37.65, 2025: 37.54},
    "Portugal": {2018: 10.31, 2019: 10.37, 2020: 10.33, 2021: 10.38, 2022: 10.43, 2023: 10.50, 2024: 10.57, 2025: 10.64},
    "Puerto Rico": {2018: 3.19, 2019: 3.19, 2020: 3.17, 2021: 3.14, 2022: 3.11, 2023: 3.07, 2024: 3.04, 2025: 3.00},
    "Republic of the Congo": {2018: 5.26, 2019: 5.54, 2020: 5.85, 2021: 6.17, 2022: 6.51, 2023: 6.88, 2024: 7.27, 2025: 7.68},
    "Romania": {2018: 19.12, 2019: 19.05, 2020: 18.97, 2021: 18.87, 2022: 18.75, 2023: 18.62, 2024: 18.49, 2025: 18.36},
    "Russia": {2018: 146.88, 2019: 147.50, 2020: 147.91, 2021: 148.40, 2022: 148.86, 2023: 149.19, 2024: 149.36, 2025: 149.38},
    "Rwanda": {2018: 12.89, 2019: 13.46, 2020: 14.05, 2021: 14.65, 2022: 15.28, 2023: 15.92, 2024: 16.59, 2025: 17.28},
    "Saudi Arabia": {2018: 33.41, 2019: 34.22, 2020: 34.81, 2021: 35.34, 2022: 35.84, 2023: 36.41, 2024: 37.00, 2025: 37.61},
    "Senegal": {2018: 16.30, 2019: 16.97, 2020: 17.67, 2021: 18.39, 2022: 19.13, 2023: 19.90, 2024: 20.69, 2025: 21.50},
    "Serbia": {2018: 6.88, 2019: 6.87, 2020: 6.88, 2021: 6.89, 2022: 6.90, 2023: 6.91, 2024: 6.92, 2025: 6.93},
    "Seychelles": {2018: 0.10, 2019: 0.10, 2020: 0.10, 2021: 0.10, 2022: 0.10, 2023: 0.10, 2024: 0.10, 2025: 0.10},
    "Sierra Leone": {2018: 7.98, 2019: 8.30, 2020: 8.62, 2021: 8.96, 2022: 9.31, 2023: 9.68, 2024: 10.07, 2025: 10.47},
    "Singapore": {2018: 5.64, 2019: 5.70, 2020: 5.69, 2021: 5.74, 2022: 5.85, 2023: 5.97, 2024: 6.09, 2025: 6.22},
    "Slovakia": {2018: 5.46, 2019: 5.46, 2020: 5.46, 2021: 5.47, 2022: 5.48, 2023: 5.50, 2024: 5.51, 2025: 5.52},
    "Slovenia": {2018: 2.12, 2019: 2.13, 2020: 2.14, 2021: 2.15, 2022: 2.17, 2023: 2.18, 2024: 2.20, 2025: 2.22},
    "South Africa": {2018: 56.80, 2019: 58.40, 2020: 60.14, 2021: 61.94, 2022: 63.78, 2023: 65.65, 2024: 67.55, 2025: 69.48},
    "South Korea": {2018: 51.78, 2019: 51.78, 2020: 51.78, 2021: 51.78, 2022: 51.78, 2023: 51.67, 2024: 51.56, 2025: 51.45},
    "Spain": {2018: 47.43, 2019: 47.56, 2020: 47.56, 2021: 47.61, 2022: 47.62, 2023: 47.73, 2024: 47.87, 2025: 48.02},
    "Sri Lanka": {2018: 21.69, 2019: 21.99, 2020: 22.28, 2021: 22.55, 2022: 22.79, 2023: 22.99, 2024: 23.16, 2025: 23.30},
    "Sudan": {2018: 42.81, 2019: 44.48, 2020: 46.24, 2021: 48.09, 2022: 47.89, 2023: 46.88, 2024: 45.93, 2025: 45.02},
    "Suriname": {2018: 0.61, 2019: 0.61, 2020: 0.61, 2021: 0.61, 2022: 0.61, 2023: 0.61, 2024: 0.62, 2025: 0.62},
    "Sweden": {2018: 10.34, 2019: 10.49, 2020: 10.49, 2021: 10.52, 2022: 10.56, 2023: 10.61, 2024: 10.67, 2025: 10.73},
    "Switzerland": {2018: 8.71, 2019: 8.80, 2020: 8.86, 2021: 8.94, 2022: 9.03, 2023: 9.14, 2024: 9.25, 2025: 9.37},
    "Taiwan": {2018: 23.62, 2019: 23.68, 2020: 23.78, 2021: 23.88, 2022: 23.95, 2023: 24.00, 2024: 23.99, 2025: 23.96},
    "Tajikistan": {2018: 9.13, 2019: 9.39, 2020: 9.66, 2021: 9.95, 2022: 10.26, 2023: 10.57, 2024: 10.90, 2025: 11.23},
    "Tanzania": {2018: 59.73, 2019: 62.20, 2020: 64.77, 2021: 67.44, 2022: 70.21, 2023: 73.08, 2024: 76.04, 2025: 79.09},
    "Timor-Leste": {2018: 1.32, 2019: 1.37, 2020: 1.43, 2021: 1.49, 2022: 1.55, 2023: 1.61, 2024: 1.67, 2025: 1.74},
    "Togo": {2018: 8.49, 2019: 8.85, 2020: 9.24, 2021: 9.64, 2022: 10.06, 2023: 10.50, 2024: 10.96, 2025: 11.44},
    "Tunisia": {2018: 11.81, 2019: 12.01, 2020: 12.23, 2021: 12.44, 2022: 12.66, 2023: 12.87, 2024: 13.08, 2025: 13.29},
    "Turkey": {2018: 82.46, 2019: 83.62, 2020: 84.78, 2021: 85.93, 2022: 87.07, 2023: 88.19, 2024: 89.29, 2025: 90.38},
    "Turkmenistan": {2018: 6.03, 2019: 6.19, 2020: 6.35, 2021: 6.52, 2022: 6.70, 2023: 6.88, 2024: 7.07, 2025: 7.27},
    "Uganda": {2018: 45.74, 2019: 48.04, 2020: 50.50, 2021: 53.10, 2022: 55.80, 2023: 58.59, 2024: 61.48, 2025: 64.46},
    "Ukraine": {2018: 41.92, 2019: 41.73, 2020: 41.59, 2021: 41.59, 2022: 41.14, 2023: 38.00, 2024: 37.73, 2025: 37.47},
    "United Arab Emirates": {2018: 9.89, 2019: 10.18, 2020: 10.37, 2021: 10.62, 2022: 10.88, 2023: 11.15, 2024: 11.43, 2025: 11.71},
    "United Kingdom": {2018: 67.34, 2019: 67.99, 2020: 68.28, 2021: 68.42, 2022: 68.50, 2023: 68.65, 2024: 68.91, 2025: 69.23},
    "United States": {2018: 327.72, 2019: 331.00, 2020: 331.45, 2021: 333.00, 2022: 333.95, 2023: 335.46, 2024: 336.89, 2025: 338.29},
    "Uruguay": {2018: 3.47, 2019: 3.48, 2020: 3.48, 2021: 3.48, 2022: 3.48, 2023: 3.48, 2024: 3.48, 2025: 3.48},
    "Uzbekistan": {2018: 32.95, 2019: 33.73, 2020: 34.51, 2021: 35.28, 2022: 35.98, 2023: 36.61, 2024: 37.18, 2025: 37.71},
    "Vietnam": {2018: 96.49, 2019: 97.99, 2020: 99.54, 2021: 101.13, 2022: 102.73, 2023: 104.36, 2024: 106.00, 2025: 107.67},
    "Zambia": {2018: 17.86, 2019: 18.92, 2020: 20.05, 2021: 21.25, 2022: 22.51, 2023: 23.84, 2024: 25.23, 2025: 26.68},
    "Zimbabwe": {2018: 15.60, 2019: 16.00, 2020: 16.42, 2021: 16.86, 2022: 17.32, 2023: 17.80, 2024: 18.30, 2025: 18.82},
}


def main():
    """
    Main execution function.
    """
    try:
        # Check if input file exists
        if not Path(INPUT_FILE).exists():
            print(f"❌ Error: {INPUT_FILE} not found")
            return

        print(f"Loading {INPUT_FILE}...")
        df = pd.read_csv(INPUT_FILE)
        print(f"✅ Loaded {len(df)} countries")

        # Create per capita version
        df_percapita = df.copy()

        print(f"Calculating per capita values...")
        success_count = 0
        missing_count = 0

        for idx, row in df.iterrows():
            country = row["Country"]

            if country not in POPULATION_DATA:
                missing_count += 1
                continue

            success_count += 1
            country_pop = POPULATION_DATA[country]

            for year in YEARS:
                year_col = str(year)

                # Get transaction value
                transaction_val = row[year_col]
                if isinstance(transaction_val, str):
                    transaction_val = float(transaction_val.replace(",", ""))

                # Get population for this year (in millions)
                population = country_pop.get(year)

                if population and transaction_val:
                    # Transaction values are in billions, convert to USD then divide by population
                    per_capita = (transaction_val * 1_000_000_000) / (population * 1_000_000)
                    df_percapita.loc[idx, year_col] = round(per_capita, 2)
                else:
                    df_percapita.loc[idx, year_col] = None

            if (idx + 1) % 30 == 0:
                print(f"  Processed {idx + 1}/{len(df)} countries...")

        # Save to CSV
        print(f"\nSaving to {OUTPUT_FILE}...")
        df_percapita.to_csv(OUTPUT_FILE, index=False)

        print(f"\n✅ Done! Per capita data saved to {OUTPUT_FILE}")
        print(f"\nSummary:")
        print(f"- Countries processed: {success_count}")
        print(f"- Missing data: {missing_count}")
        print(f"- Years: {', '.join(map(str, YEARS))}")
        print(f"- Values: Per capita transaction amounts (USD)")

    except Exception as e:
        print(f"❌ Error: {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    main()
